<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Tarea 2</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>



<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<h1>Tarea 2</h1>

<h2>Carga de paquetes</h2>

<p>Cargamos todos los paquetes que van a servir a lo largo del estudio. Utilizamos la funcion p_load del paquete pacman debido a que si no está el paquete en la librería intenta descargarlo desde CRAN u otro repositorio.</p>

<pre><code class="r">pacman::p_load(Biobase, enriquepresa, genefilter, limma, ReportingTools)
</code></pre>

<h2>Carga del Expression set</h2>

<p>En primer lugar es necesario cargar el Expression set del estudio en cuestión, que es el GSE50467, y que ya ha sido normalizado y que ha pasado unos controles de calidad.</p>

<pre><code class="r">data(Eset50467, package=&quot;enriquepresa&quot;)
</code></pre>

<h2>T-test con varianzas iguales</h2>

<p>En primer lugar, se va a observar qué genes se expresan diferencialmente mediante un t-test suponiendo varianzas iguales. Los dos grupos que tiene este experimento para comparar son ambos líneas celulares idénticas pero a un grupo no se le ha aplicado ningún compuesto y al otro se le ha aplicado doxiciclina para sobreexpresar el gen SRSF2, y se quiere estudiar qué genes se ven afectados por este cambio en la expresión de este gen. Por tanto, se va a hacer un test-t para cada sonda del microarray teniendo en cuenta estos dos grupos. Se va a hacer mediante la función <em>rowttests</em> del paquete genefilter, y se va a obtener un primer data frame en el que se observa el valor del estadístico t,la diferencia de medias de cada grupo (<em>dm</em>) y el p-valor observado para cada sonda. El nombre de las filas es el <em>probe id</em>. En realidad, la columna <em>dm</em> debería ser llamada <em>LogFC</em>, debido a que el Expression Set ya tiene el logaritmo en base 2 de la expresión debido a una corrección de fondo que se ha hecho en el Expression Set de tipo <em>normexp</em>.</p>

<pre><code class="r">grupos = pData(Eset50467)[,&quot;FactorValue..compound.&quot;]
genefilter_df = rowttests(Eset50467, grupos)
colnames(genefilter_df)[2] = &quot;LogFC&quot;
head(genefilter_df)
</code></pre>

<h4>Comparaciones múltiples</h4>

<p>Debido a que no se hace una sola observación, sino que se hace tantas observaciones como sondas válidas tenga el microarray, es necesario hacer un ajuste del p-valor, tanto por el método de Benjamini-Hochberg, como por el método de Bonferroni, que es más conservador.</p>

<pre><code class="r">BH = p.adjust(genefilter_df$p.value, method = &quot;BH&quot;)
Bonferroni = p.adjust(genefilter_df$p.value, method = &quot;bonferroni&quot;)
genefilter_df = cbind(genefilter_df, BH, Bonferroni)
genefilter_df = genefilter_df[order(BH),] #Se ordenan las filas en orden decreciente según el adj. p-value según el método BH
</code></pre>

<h4>Obtención de URL&#39;s a ENTREZ y ENSEMBL</h4>

<p>Para obtener un estudio más explicativo, es necesario que el investigador al que se le van a pasar los resultados tenga un acceso directo a la información que pueden incorporar ENTREZ y ENSEMBL, por lo que será necesario incorporar las URL&#39;s de los genes a ENTREZ y ENSEMBL. Para ello, se han utilizado dos funciones homólogas a las dos incorporadas en el paquete <em>tami</em>. Por otra parte, también se considera necesario incorporar el nombre del gen al data frame (<em>SYMBOL</em> en el fData).</p>

<pre><code class="r">fd = fData(Eset50467)
entrezids = sapply(rownames(genefilter_df), function(x){fd[fd$PROBEID==x,&quot;ENTREZID&quot;]})
ENTREZ_URL = sapply(entrezids, entrezurl)
ensemblids = sapply(rownames(genefilter_df), function(x){fd[fd$PROBEID==x,&quot;ENSEMBL&quot;]})
ENSEMBL_URL = sapply(ensemblids, ensemblurl)
SYMBOL = sapply(rownames(genefilter_df), function(x){fd[fd$PROBEID==x,&quot;SYMBOL&quot;]})

genefilter_df = cbind(SYMBOL, genefilter_df, ENTREZ_URL, ENSEMBL_URL)
head(genefilter_df)
</code></pre>

<h4>Generación de un fichero html</h4>

<p>Por último, se va a generar un fichero html con el data frame gracias al paquete <em>ReportingTools</em>.</p>

<pre><code class="r">foutput = &quot;GSE50467_rowttests&quot;
htmlRep1 = HTMLReport(shortName = foutput,title = foutput,
                      reportDirectory = &quot;./reports/differential_expression&quot;)

publish(genefilter_df, htmlRep1)
finish(htmlRep1)
</code></pre>

<h4>Guardado del data frame</h4>

<p>También se procede a guardar el data frame en el subdirectorio <em>reports</em> del paquete.</p>

<pre><code class="r">save(genefilter_df, file=&quot;./reports/genefilter_df.rda&quot;, compress = &quot;xz&quot;)
</code></pre>

<h2>T-test moderado</h2>

<p>Ahora se va a realizar un estudio muy similar pero en este caso se va a hacer un test-t moderado (sin suponer varianzas iguales). Para ello, se va a utilizar el paquete limma.</p>

<h4>Generación de la matriz de diseño</h4>

<p>En primer lugar, es necesario hacer una matriz de diseño con los dos grupos a comparar.</p>

<pre><code class="r">grupos= pData(Eset50467)[,&quot;FactorValue..compound.&quot;]
design = model.matrix(~0+grupos)
colnames(design) = c(&quot;doxycycline&quot;, &quot;control&quot;)
design
</code></pre>

<h4>Ajuste de modelo y generación de contrastes</h4>

<p>En segundo lugar es necesario ajustar el modelo y hacer el contraste que queremos observar: muestras con doxiciclina contra muestras control.</p>

<pre><code class="r">fit = lmFit(Eset50467, design)
cont.matrix &lt;- makeContrasts(doxycycline - control, levels=design)
</code></pre>

<h4>Estimación con limma</h4>

<p>Por último se hace la estimación con limma utilizando la función eBayes y se ajusta el p-valor para comparaciones múltiples tanto por el método de Bonferroni como por el de Benjamini-Hochberg.  </p>

<pre><code class="r">fit2 &lt;- contrasts.fit(fit, cont.matrix)
fit2 &lt;- eBayes(fit2)
tT &lt;- topTable(fit2, coef = 1, adjust = &quot;BH&quot;, number = nrow(Eset50467))
tT2 &lt;- topTable(fit2, coef = 1, adjust = &quot;bonferroni&quot;, number = nrow(Eset50467))
</code></pre>

<h2>Generación del data frame</h2>

<p>Para generar un data frame con la información más importante, es necesario quedarnos con el nombre del gen, el estadístico t, el log-fold change, el p-valor y los p-valores ajustados tanto por el método de Bonferroni como por el de Benjamini-Hochberg, además de las URL&#39;s para ENTREZ y ENSEMBL para cada gen, de tal manera que sea un data frame explicativo y con el que un investigador pueda obtener información fácil y directamente.</p>

<pre><code class="r">entrezurls = sapply(tT$ENTREZID, entrezurl)
ensemblurls = sapply(tT$ENSEMBL, ensemblurl)
limma_df = data.frame(SYMBOL = tT$SYMBOL, statistic = tT$t, LogFC=tT$logFC, p.value=tT$P.Value,
                BH=tT$adj.P.Val, Bonferroni=tT2$adj.P.Val, ENTREZ_URL=entrezurls, ENSEMBL_URL=ensemblurls)
rownames(limma_df) = tT$PROBEID
head(limma_df)
</code></pre>

<h4>Generación de un fichero html</h4>

<p>Al igual que antes, se va a generar un fichero html con el data frame gracias al paquete <em>ReportingTools</em>.</p>

<pre><code class="r">foutput = &quot;GSE50467_limma&quot;
htmlRep1 = HTMLReport(shortName = foutput,title = foutput,
                      reportDirectory = &quot;./reports/differential_expression&quot;)

publish(limma_df, htmlRep1)
finish(htmlRep1)
</code></pre>

<h4>Guardado del data frame</h4>

<p>También se procede a guardar el data frame en el subdirectorio <em>reports</em> del paquete, al igual que antes.</p>

<pre><code class="r">save(limma_df, file=&quot;./reports/limma_df.rda&quot;, compress = &quot;xz&quot;)
</code></pre>

<h2>Volcano plot</h2>

<p>Para observar los datos se va a realizar un Volcano plot gracias a una función incorporada en este paquete. Un volcano plot es un tipo de representación en el que como valor de abscisas se representa el log-fold change y como valor de ordenada se representa el valor opuesto al logaritmo en base 10 del p-valor. Todo esto para cada gen, de tal manera que nos hacemos una idea de todos los genes que se expresan de forma diferencial por encima de un límite establecido y con un p-valor menor a uno dado. 
Como ejemplo se utilizará el ajuste de Benjamini-Hochberg y se marcarán aquellos genes que tengan se expresen el doble en el control o en el caso (por tanto logFC=1) y con un p-valor menor a 0.05.</p>

<pre><code class="r">plot_volcano(genefilter_df$BH, genefilter_df$LogFC, genefilter_df$SYMBOL, min_p = 0.05, diff = 1)
</code></pre>

<p>Un logFC mínimo de 1 ya indica que el gen se sobreexprese el doble en un grupo o en otro, lo que se puede considerar bastante alto. En la publicación relacionada con el estudio GSE50467, como se detalla, buscan la expresión diferencial de genes que intervengan en la diferenciación y crecimiento celular, debido a que están estudiando un adenocarcinoma pulmonar. Por esa razón, los dos genes principales en los que observan regulación son VEGFA (sobreexpresado 1.67 veces) y EGFR (subexpresado 1.87 veces).</p>

<p>Con el procesamiento de datos hecho en este análisis se obtiene que el gen VEGFA está sobreexpresado 1.692 veces y que el gen EGFR está subexpresado 1.322 veces. Como se puede observar, para el gen VEGFA obtenemos un valor similar, pero para el gen EGFR en este caso no hay tanto cambio de expresión como afirman en la publicación.</p>

<pre><code class="r">2^(as.numeric(limma_df[limma_df$SYMBOL==&quot;VEGFA&quot;,&quot;LogFC&quot;]))
1/(2^(as.numeric(limma_df[limma_df$SYMBOL==&quot;EGFR&quot;,&quot;LogFC&quot;])))
</code></pre>

</body>

</html>
